# name: test/sql/fit_predict/test_wls_fit_predict_edge.test
# description: Test WLS fit-predict edge cases
# group: [fit_predict]

require anofox_statistics

statement ok
CREATE TABLE wls_edge AS
SELECT
    CASE WHEN i <= 6 THEN (i * 2.0 + 1.0)::DOUBLE ELSE NULL END as y,
    i::DOUBLE as x1,
    1.0::DOUBLE as w,
    i as id
FROM range(1, 11) t(i);

query I
SELECT COUNT(*) as valid_predictions
FROM (SELECT id, anofox_stats_wls_fit_predict(y, [x1], w) OVER (ORDER BY id) as pred FROM wls_edge)
WHERE (pred).yhat IS NOT NULL;
----
8

statement ok
DROP TABLE wls_edge;
