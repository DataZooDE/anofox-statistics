{"id":"anofox-statistics-0nv","title":"Run unit tests to verify compatibility with anofox-regression 0.5.1","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T14:52:17.819402351+01:00","created_by":"simonm","updated_at":"2026-01-16T14:55:04.313010234+01:00","closed_at":"2026-01-16T14:55:04.313010234+01:00","close_reason":"Closed","dependencies":[{"issue_id":"anofox-statistics-0nv","depends_on_id":"anofox-statistics-glu","type":"blocks","created_at":"2026-01-16T14:52:27.003709403+01:00","created_by":"simonm"}]}
{"id":"anofox-statistics-1g4","title":"Add options MAP to alm_fit_predict_by","description":"Add optional options MAP for distribution, intercept, max_iterations, tolerance, confidence_level, null_policy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T08:31:54.602514427+01:00","created_by":"simonm","updated_at":"2026-01-09T08:40:56.405093242+01:00","closed_at":"2026-01-09T08:40:56.405093242+01:00","close_reason":"Added options MAP parameter with default MAP{} and passed to underlying *_fit_predict_agg function","dependencies":[{"issue_id":"anofox-statistics-1g4","depends_on_id":"anofox-statistics-z99","type":"blocks","created_at":"2026-01-09T08:32:11.50973456+01:00","created_by":"simonm"}]}
{"id":"anofox-statistics-373","title":"Create validation SQL tests for large dataset segfault","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T07:46:14.516279221+01:00","created_by":"simonm","updated_at":"2026-01-16T08:57:42.583004365+01:00","closed_at":"2026-01-16T08:57:42.583004365+01:00","close_reason":"Investigation complete: missing ListVector::Reserve() call identified and fixed","dependencies":[{"issue_id":"anofox-statistics-373","depends_on_id":"anofox-statistics-qit","type":"blocks","created_at":"2026-01-16T07:46:37.211782639+01:00","created_by":"simonm"}]}
{"id":"anofox-statistics-3j0","title":"Implement fix: pre-allocate ListVector capacity before finalize loop","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T07:46:17.349022952+01:00","created_by":"simonm","updated_at":"2026-01-16T09:04:54.491841142+01:00","closed_at":"2026-01-16T09:04:54.491841142+01:00","close_reason":"Fix implemented and validated - ListVector::Reserve() added before SetListSize()","dependencies":[{"issue_id":"anofox-statistics-3j0","depends_on_id":"anofox-statistics-qit","type":"blocks","created_at":"2026-01-16T07:46:37.268868979+01:00","created_by":"simonm"},{"issue_id":"anofox-statistics-3j0","depends_on_id":"anofox-statistics-4cm","type":"blocks","created_at":"2026-01-16T07:46:38.262676441+01:00","created_by":"simonm"},{"issue_id":"anofox-statistics-3j0","depends_on_id":"anofox-statistics-hrd","type":"blocks","created_at":"2026-01-16T07:46:38.290004996+01:00","created_by":"simonm"}]}
{"id":"anofox-statistics-4cm","title":"Investigate ListVector capacity issue in AidAnomalyAggFinalize","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T07:46:13.746694919+01:00","created_by":"simonm","updated_at":"2026-01-16T08:57:42.528853704+01:00","closed_at":"2026-01-16T08:57:42.528853704+01:00","close_reason":"Investigation complete: missing ListVector::Reserve() call identified and fixed","dependencies":[{"issue_id":"anofox-statistics-4cm","depends_on_id":"anofox-statistics-qit","type":"blocks","created_at":"2026-01-16T07:46:37.17744913+01:00","created_by":"simonm"}]}
{"id":"anofox-statistics-4s4","title":"Add tests for *_fit_predict_by with options","description":"Write tests verifying options are correctly passed through to underlying *_fit_predict_agg functions","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T08:31:57.31411483+01:00","created_by":"simonm","updated_at":"2026-01-09T08:45:08.791224416+01:00","closed_at":"2026-01-09T08:45:08.791224416+01:00","close_reason":"Added 34 new tests (TEST 17-50) covering options parameter for all 8 macros: empty MAP, method-specific options, common options, and verification that options affect results","dependencies":[{"issue_id":"anofox-statistics-4s4","depends_on_id":"anofox-statistics-z8v","type":"blocks","created_at":"2026-01-09T08:32:13.350291384+01:00","created_by":"simonm"},{"issue_id":"anofox-statistics-4s4","depends_on_id":"anofox-statistics-6zm","type":"blocks","created_at":"2026-01-09T08:32:13.378534328+01:00","created_by":"simonm"},{"issue_id":"anofox-statistics-4s4","depends_on_id":"anofox-statistics-8x7","type":"blocks","created_at":"2026-01-09T08:32:13.412331454+01:00","created_by":"simonm"},{"issue_id":"anofox-statistics-4s4","depends_on_id":"anofox-statistics-pb9","type":"blocks","created_at":"2026-01-09T08:32:13.441065678+01:00","created_by":"simonm"},{"issue_id":"anofox-statistics-4s4","depends_on_id":"anofox-statistics-ooj","type":"blocks","created_at":"2026-01-09T08:32:13.472045847+01:00","created_by":"simonm"},{"issue_id":"anofox-statistics-4s4","depends_on_id":"anofox-statistics-meg","type":"blocks","created_at":"2026-01-09T08:32:13.501113204+01:00","created_by":"simonm"},{"issue_id":"anofox-statistics-4s4","depends_on_id":"anofox-statistics-1g4","type":"blocks","created_at":"2026-01-09T08:32:13.527105198+01:00","created_by":"simonm"},{"issue_id":"anofox-statistics-4s4","depends_on_id":"anofox-statistics-tia","type":"blocks","created_at":"2026-01-09T08:32:13.556046924+01:00","created_by":"simonm"}]}
{"id":"anofox-statistics-5hv","title":"Add edge case tests for empty arrays and single elements","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T07:46:18.636668429+01:00","created_by":"simonm","updated_at":"2026-01-16T09:04:54.503099691+01:00","closed_at":"2026-01-16T09:04:54.503099691+01:00","close_reason":"Fix implemented and validated - ListVector::Reserve() added before SetListSize()","dependencies":[{"issue_id":"anofox-statistics-5hv","depends_on_id":"anofox-statistics-qit","type":"blocks","created_at":"2026-01-16T07:46:37.296375026+01:00","created_by":"simonm"},{"issue_id":"anofox-statistics-5hv","depends_on_id":"anofox-statistics-3j0","type":"blocks","created_at":"2026-01-16T07:46:39.126652538+01:00","created_by":"simonm"}]}
{"id":"anofox-statistics-6mr","title":"Update anofox-regression version to 0.5.1 in Cargo.toml","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T14:52:14.966818866+01:00","created_by":"simonm","updated_at":"2026-01-16T14:53:19.793234986+01:00","closed_at":"2026-01-16T14:53:19.793234986+01:00","close_reason":"Closed"}
{"id":"anofox-statistics-6zm","title":"Add options MAP to ridge_fit_predict_by","description":"Add optional options MAP parameter for alpha, fit_intercept, confidence_level, null_policy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T08:31:48.344523812+01:00","created_by":"simonm","updated_at":"2026-01-09T08:40:56.329128734+01:00","closed_at":"2026-01-09T08:40:56.329128734+01:00","close_reason":"Added options MAP parameter with default MAP{} and passed to underlying *_fit_predict_agg function","dependencies":[{"issue_id":"anofox-statistics-6zm","depends_on_id":"anofox-statistics-z99","type":"blocks","created_at":"2026-01-09T08:32:11.365693111+01:00","created_by":"simonm"}]}
{"id":"anofox-statistics-8x7","title":"Add options MAP to elasticnet_fit_predict_by","description":"Add optional options MAP for alpha, l1_ratio, max_iterations, tolerance, fit_intercept, confidence_level, null_policy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T08:31:49.564608871+01:00","created_by":"simonm","updated_at":"2026-01-09T08:40:56.343027835+01:00","closed_at":"2026-01-09T08:40:56.343027835+01:00","close_reason":"Added options MAP parameter with default MAP{} and passed to underlying *_fit_predict_agg function","dependencies":[{"issue_id":"anofox-statistics-8x7","depends_on_id":"anofox-statistics-z99","type":"blocks","created_at":"2026-01-09T08:32:11.392489162+01:00","created_by":"simonm"}]}
{"id":"anofox-statistics-bdl","title":"Update API_REFERENCE.md documentation","description":"Update Fit-Predict Table Macros section to document new options parameter for each macro","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T08:31:58.475233746+01:00","created_by":"simonm","updated_at":"2026-01-09T08:47:33.219854103+01:00","closed_at":"2026-01-09T08:47:33.219854103+01:00","close_reason":"Updated Fit-Predict Table Macros section with options parameter documentation for all 8 macros including signatures, options tables, and examples","dependencies":[{"issue_id":"anofox-statistics-bdl","depends_on_id":"anofox-statistics-4s4","type":"blocks","created_at":"2026-01-09T08:32:14.469279349+01:00","created_by":"simonm"}]}
{"id":"anofox-statistics-glu","title":"Run cargo update to refresh Cargo.lock","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T14:52:16.392625168+01:00","created_by":"simonm","updated_at":"2026-01-16T14:53:37.229803574+01:00","closed_at":"2026-01-16T14:53:37.229803574+01:00","close_reason":"Closed","dependencies":[{"issue_id":"anofox-statistics-glu","depends_on_id":"anofox-statistics-6mr","type":"blocks","created_at":"2026-01-16T14:52:25.826833264+01:00","created_by":"simonm"}]}
{"id":"anofox-statistics-hrd","title":"Review other aggregate functions for list handling patterns","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T07:46:16.29662041+01:00","created_by":"simonm","updated_at":"2026-01-16T08:57:42.563557739+01:00","closed_at":"2026-01-16T08:57:42.563557739+01:00","close_reason":"Investigation complete: missing ListVector::Reserve() call identified and fixed","dependencies":[{"issue_id":"anofox-statistics-hrd","depends_on_id":"anofox-statistics-qit","type":"blocks","created_at":"2026-01-16T07:46:37.239181063+01:00","created_by":"simonm"}]}
{"id":"anofox-statistics-j0j","title":"Verify full build passes with new dependency version","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T14:52:18.708716791+01:00","created_by":"simonm","updated_at":"2026-01-16T14:55:04.332976869+01:00","closed_at":"2026-01-16T14:55:04.332976869+01:00","close_reason":"Closed","dependencies":[{"issue_id":"anofox-statistics-j0j","depends_on_id":"anofox-statistics-glu","type":"blocks","created_at":"2026-01-16T14:52:28.083420896+01:00","created_by":"simonm"}]}
{"id":"anofox-statistics-kkk","title":"Implement *_fit_predict_by table macros for regression functions","description":"## Overview\n\nImplement table macros for regression fit-predict functions following the pattern established by `ts_forecast_by` in anofox-forecast extension. These macros will provide a user-friendly SQL interface for running regression predictions on grouped data.\n\n## Background\n\nThe anofox-forecast extension provides `ts_forecast_by` as a table macro that:\n- Wraps the lower-level `_ts_forecast()` scalar function\n- Provides column-by-name interface (unquoted identifiers)\n- Handles grouping/ungrouping automatically\n- Unnests results into long format (one row per prediction)\n- Uses `query_table(source::VARCHAR)` for dynamic table references\n\n## Proposed Functions\n\nCreate table macros for each `*_fit_predict_agg` function:\n\n| Table Macro | Wraps |\n|-------------|-------|\n| `ols_fit_predict_by` | `ols_fit_predict_agg` |\n| `ridge_fit_predict_by` | `ridge_fit_predict_agg` |\n| `elasticnet_fit_predict_by` | `elasticnet_fit_predict_agg` |\n| `wls_fit_predict_by` | `wls_fit_predict_agg` |\n| `rls_fit_predict_by` | `rls_fit_predict_agg` |\n| `bls_fit_predict_by` | `bls_fit_predict_agg` |\n| `alm_fit_predict_by` | `alm_fit_predict_agg` |\n| `poisson_fit_predict_by` | `poisson_fit_predict_agg` |\n\n## Proposed Signature\n\n```sql\nols_fit_predict_by(\n    source,      -- VARCHAR: table name\n    group_col,   -- IDENTIFIER: grouping column\n    y_col,       -- IDENTIFIER: target variable\n    x_cols,      -- LIST or IDENTIFIER[]: feature columns\n    options      -- MAP: optional parameters\n) -\u003e TABLE\n```\n\n## Expected Output Format (Long Format)\n\n| Column | Type | Description |\n|--------|------|-------------|\n| group_id | ANY | Group identifier |\n| row_idx | INTEGER | Original row index |\n| y | DOUBLE | Original y value (NULL for OOS) |\n| x | LIST(DOUBLE) | Feature values |\n| yhat | DOUBLE | Predicted value |\n| yhat_lower | DOUBLE | Lower prediction interval |\n| yhat_upper | DOUBLE | Upper prediction interval |\n| is_training | BOOLEAN | Training vs OOS indicator |\n\n## Implementation Pattern\n\nFollow the pattern from `ts_forecast_by` in anofox-forecast:\n\n1. **SQL Macro Definition** in `src/macros/`:\n   ```sql\n   WITH predictions AS (\n       SELECT\n           group_col AS group_id,\n           *_fit_predict_agg(y_col, [x_cols...], options) AS pred\n       FROM query_table(source::VARCHAR)\n       GROUP BY group_col\n   )\n   SELECT\n       group_id,\n       UNNEST(pred) AS prediction\n   FROM predictions\n   ```\n\n2. **C++ Registration** following `TsTableMacro` struct pattern\n\n3. **Test Coverage** for each macro\n\n## Reference Implementation\n\nSee anofox-forecast:\n- `src/macros/ts_macros.cpp` (lines 466-555)\n- `test/sql/ts_forecast_by.test`\n\n## Acceptance Criteria\n\n- [ ] All 8 table macros implemented\n- [ ] Column-by-name interface (unquoted identifiers)\n- [ ] Long format output with unnested predictions\n- [ ] Options MAP passed through to underlying aggregate\n- [ ] Comprehensive test coverage\n- [ ] Documentation in API_REFERENCE.md","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-08T19:12:11.516701682+01:00","created_by":"simonm","updated_at":"2026-01-08T20:24:12.135058287+01:00","closed_at":"2026-01-08T20:24:12.135058287+01:00","close_reason":"Implemented 8 *_fit_predict_by table macros with tests"}
{"id":"anofox-statistics-meg","title":"Add options MAP to bls_fit_predict_by","description":"Add optional options MAP for lower_bound, upper_bound, intercept, max_iterations, tolerance, confidence_level, null_policy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T08:31:53.330671303+01:00","created_by":"simonm","updated_at":"2026-01-09T08:40:56.390924612+01:00","closed_at":"2026-01-09T08:40:56.390924612+01:00","close_reason":"Added options MAP parameter with default MAP{} and passed to underlying *_fit_predict_agg function","dependencies":[{"issue_id":"anofox-statistics-meg","depends_on_id":"anofox-statistics-z99","type":"blocks","created_at":"2026-01-09T08:32:11.481414876+01:00","created_by":"simonm"}]}
{"id":"anofox-statistics-og8","title":"Add options parameter to *_fit_predict_by table macros","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-09T08:31:31.427664474+01:00","created_by":"simonm","updated_at":"2026-01-09T08:47:39.628582865+01:00","closed_at":"2026-01-09T08:47:39.628582865+01:00","close_reason":"Feature complete: Added options MAP parameter to all 8 *_fit_predict_by table macros with tests and documentation"}
{"id":"anofox-statistics-ooj","title":"Add options MAP to rls_fit_predict_by","description":"Add optional options MAP for forgetting_factor, initial_p_diagonal, fit_intercept, confidence_level, null_policy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T08:31:52.021302044+01:00","created_by":"simonm","updated_at":"2026-01-09T08:40:56.376162287+01:00","closed_at":"2026-01-09T08:40:56.376162287+01:00","close_reason":"Added options MAP parameter with default MAP{} and passed to underlying *_fit_predict_agg function","dependencies":[{"issue_id":"anofox-statistics-ooj","depends_on_id":"anofox-statistics-z99","type":"blocks","created_at":"2026-01-09T08:32:11.453702418+01:00","created_by":"simonm"}]}
{"id":"anofox-statistics-pb9","title":"Add options MAP to wls_fit_predict_by","description":"Add optional options MAP for fit_intercept, confidence_level, null_policy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T08:31:50.435890473+01:00","created_by":"simonm","updated_at":"2026-01-09T08:40:56.360830949+01:00","closed_at":"2026-01-09T08:40:56.360830949+01:00","close_reason":"Added options MAP parameter with default MAP{} and passed to underlying *_fit_predict_agg function","dependencies":[{"issue_id":"anofox-statistics-pb9","depends_on_id":"anofox-statistics-z99","type":"blocks","created_at":"2026-01-09T08:32:11.42339594+01:00","created_by":"simonm"}]}
{"id":"anofox-statistics-qit","title":"Fix aid_anomaly_agg segfault on large datasets (GH #25)","description":"GitHub Issue: https://github.com/DataZooDE/anofox-statistics/issues/25 - aid_anomaly_agg crashes with segfault on 512K+ series. Similar to anofox-forecast PR #84 empty array handling issue. Root cause likely ListVector capacity not being pre-allocated before finalize loop.","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-16T07:46:27.45761818+01:00","created_by":"simonm","updated_at":"2026-01-16T09:05:01.76101633+01:00","closed_at":"2026-01-16T09:05:01.76101633+01:00","close_reason":"Fix complete: Added missing ListVector::Reserve() call in AidAnomalyAggFinalize. All 136 test cases pass."}
{"id":"anofox-statistics-tia","title":"Add options MAP to poisson_fit_predict_by","description":"Add optional options MAP for link, intercept, max_iterations, tolerance, confidence_level, null_policy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T08:31:55.771304582+01:00","created_by":"simonm","updated_at":"2026-01-09T08:40:56.418960159+01:00","closed_at":"2026-01-09T08:40:56.418960159+01:00","close_reason":"Added options MAP parameter with default MAP{} and passed to underlying *_fit_predict_agg function","dependencies":[{"issue_id":"anofox-statistics-tia","depends_on_id":"anofox-statistics-z99","type":"blocks","created_at":"2026-01-09T08:32:11.543057541+01:00","created_by":"simonm"}]}
{"id":"anofox-statistics-z8v","title":"Add options MAP to ols_fit_predict_by","description":"Add optional options MAP parameter for fit_intercept, confidence_level, null_policy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T08:31:47.46271717+01:00","created_by":"simonm","updated_at":"2026-01-09T08:40:56.318516144+01:00","closed_at":"2026-01-09T08:40:56.318516144+01:00","close_reason":"Added options MAP parameter with default MAP{} and passed to underlying *_fit_predict_agg function","dependencies":[{"issue_id":"anofox-statistics-z8v","depends_on_id":"anofox-statistics-z99","type":"blocks","created_at":"2026-01-09T08:32:11.336793869+01:00","created_by":"simonm"}]}
{"id":"anofox-statistics-z99","title":"Locate table macro definitions in codebase","description":"Find where *_fit_predict_by macros are defined to understand current implementation","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T08:31:46.573925933+01:00","created_by":"simonm","updated_at":"2026-01-09T08:35:08.290459049+01:00","closed_at":"2026-01-09T08:35:08.290459049+01:00","close_reason":"Located macros in src/macros/fit_predict_macros.cpp. Structure already supports named_params with defaults - just need to add options parameter.","comments":[{"id":1,"issue_id":"anofox-statistics-z99","author":"simonm","text":"## Findings\n\n**File:** src/macros/fit_predict_macros.cpp (lines 1-311)\n\n**Structure:** The FitPredictTableMacro struct already supports named parameters with defaults via named_params[8], but all 8 macros have {{nullptr, nullptr}} - not using this feature.\n\n**Solution:** Add 'options' as a named parameter with default MAP{} and pass it to the underlying aggregate function in the SQL.\n\n**Helper function:** CreateFitPredictTableMacro() at line 263 already handles named_params correctly - parses defaults and adds them to function-\u003edefault_parameters.","created_at":"2026-01-09T07:35:02Z"}]}
