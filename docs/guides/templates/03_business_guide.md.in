# Business Guide

Practical business applications of regression analysis using the Anofox Statistics extension with SQL examples for common use cases.

## Introduction

This guide demonstrates regression analysis techniques for business use cases using the Anofox Statistics extension for DuckDB. Each section presents SQL implementations of statistical methods applied to specific business domains: marketing, finance, operations, and sales.

The guide covers five regression methods available in the extension:

- **OLS (Ordinary Least Squares)**: Standard linear regression for estimating relationships between variables
- **WLS (Weighted Least Squares)**: Accounts for heteroscedasticity by weighting observations differently
- **Ridge Regression**: Applies L2 regularization to handle multicollinearity in correlated predictors
- **RLS (Recursive Least Squares)**: Adapts coefficients sequentially for non-stationary time series data
- **Elastic Net**: Combines L1 and L2 penalties for variable selection and regularization

Each use case includes executable SQL code with sample data generation, statistical interpretation of results, and decision frameworks based on regression outputs. The examples use aggregate functions (`_fit_agg`) for GROUP BY and window operations, and table functions (`_fit`) for batch processing with array inputs.

All code examples execute directly in DuckDB after loading the extension. The SQL patterns demonstrate integration of regression analysis into data pipelines without requiring external statistical software.

**⚠️ Important Notice**: All examples in this guide are illustrative and for educational purposes. Results and recommendations must be validated and tested case-by-case for your specific business context before making decisions.

## Table of Contents

- [Important Note About Examples](#important-note-about-examples)
- [Marketing Analytics](#marketing-analytics)
  - [Use Case 1: Marketing Mix Modeling](#use-case-1-marketing-mix-modeling)
  - [Use Case 2: Price Elasticity Analysis](#use-case-2-price-elasticity-analysis)
  - [Use Case 3: Customer Lifetime Value Prediction](#use-case-3-customer-lifetime-value-prediction)
  - [Use Case 3b: Customer Segment Analysis with WLS Aggregate](#use-case-3b-customer-segment-analysis-with-wls-aggregate)
- [Financial Analytics](#financial-analytics)
  - [Use Case 4: Portfolio Beta Calculation](#use-case-4-portfolio-beta-calculation)
  - [Use Case 4b: Multi-Factor Portfolio Analysis with Ridge Aggregate](#use-case-4b-multi-factor-portfolio-analysis-with-ridge-aggregate)
  - [Use Case 5: Credit Risk Modeling](#use-case-5-credit-risk-modeling)
  - [Use Case 6: Revenue Forecasting with Trend Analysis](#use-case-6-revenue-forecasting-with-trend-analysis)
- [Operational Analytics](#operational-analytics)
  - [Use Case 7: Demand Forecasting for Inventory](#use-case-7-demand-forecasting-for-inventory)
  - [Use Case 7b: Adaptive Demand Forecasting with RLS Aggregate](#use-case-7b-adaptive-demand-forecasting-with-rls-aggregate)
  - [Use Case 8: Quality Control Process Optimization](#use-case-8-quality-control-process-optimization)
  - [Use Case 9: Employee Productivity Analysis](#use-case-9-employee-productivity-analysis)
- [Sales Analytics](#sales-analytics)
  - [Use Case 10: Territory Performance Analysis](#use-case-10-territory-performance-analysis)
  - [Use Case 11: Regional Sales Analysis with OLS Aggregate](#use-case-11-regional-sales-analysis-with-ols-aggregate)
- [Key Business Metrics & Interpretation](#key-business-metrics--interpretation)
  - [Understanding R² (R-Squared)](#understanding-r²-r-squared)
  - [Understanding P-Values](#understanding-p-values)
  - [Understanding Coefficients](#understanding-coefficients)
  - [Understanding Confidence Intervals](#understanding-confidence-intervals)
  - [Understanding Outliers & Influence](#understanding-outliers--influence)
- [ROI Analysis Framework](#roi-analysis-framework)
  - [Marketing Campaign ROI](#marketing-campaign-roi)
  - [Process Improvement ROI](#process-improvement-roi)
- [Best Practices for Business Users](#best-practices-for-business-users)
  - [1. Always Check Statistical Significance](#1-always-check-statistical-significance)
  - [2. Validate Model Quality](#2-validate-model-quality)
  - [3. Use Confidence Intervals for Risk Management](#3-use-confidence-intervals-for-risk-management)
  - [4. Consider Business Context](#4-consider-business-context)
  - [5. Monitor Model Performance Over Time](#5-monitor-model-performance-over-time)
  - [6. Combine Multiple Models](#6-combine-multiple-models)

## Important Note About Examples

**All examples below are copy-paste runnable!** Each example includes sample data creation.

**Working Patterns**:

- **Aggregate functions** (`anofox_statistics_ols_fit_agg`, etc.) work directly with table data - use these for GROUP BY analysis
- **Table functions** (`anofox_statistics_ols_fit`, `anofox_statistics_predict_ols`) require literal arrays - examples show small datasets with explicit arrays
- **Inference** is integrated into fit functions using `full_output=true` option
- All functions use positional parameters with MAP options (no `:=` syntax)

**To adapt for your tables**: Replace sample data creation with your actual tables. For table functions with large datasets, use the two-step approach: run `SELECT LIST(column) FROM table`, copy result, paste as literal array.

[↑ Go to Top](#business-guide)

## Marketing Analytics

### Use Case 1: Marketing Mix Modeling

**Business Question**: Which marketing channels drive the most sales?

<!-- include: test/sql/guide04_use_case_1_marketing_mix_modeling.sql -->

**Business Interpretation**:

- **ROI (coefficient)**: For every $1 increase in channel spend, revenue increases by $X
- **R²**: How well the channel spend predicts revenue (higher is better)
- Univariate analysis shows individual channel impact

**Business Decision**: Prioritize channels with highest ROI. Digital and TV show strongest returns.

### Use Case 2: Price Elasticity Analysis

**Business Question**: How sensitive are customers to price changes?

<!-- include: test/sql/guide04_use_case_2_price_elasticity_analysis.sql -->

**Business Interpretation**:

- **Negative elasticity**: Lower prices → higher quantity (normal demand curve)
- **High |elasticity|**: Elastic demand - customers are price-sensitive
- **R²**: How well price predicts quantity

**Business Decision**: Use competitive pricing for elastic categories, premium pricing for inelastic categories.

### Use Case 3: Customer Lifetime Value Prediction

**Business Question**: Predict future customer value to guide acquisition spending.

<!-- include: test/sql/guide04_use_case_3_customer_lifetime_value_predi.sql -->

**Business Interpretation**:

- **Coefficient**: Impact of each factor on customer lifetime value
- **R²**: How well features predict CLV
- **Tenure** and **frequency** typically show strongest CLV correlation

**Business Decision**: Focus acquisition on customers likely to have high tenure and purchase frequency.

### Use Case 3b: Customer Segment Analysis with WLS Aggregate

**Business Question**: How do customer segments differ in their spending patterns? Are some segments more reliable to analyze than others?

**Method**: Use `anofox_statistics_wls_agg` with GROUP BY to fit separate models per segment, weighting by customer value or data reliability.

<!-- include: test/sql/guide04_customer_segments_wls.sql -->

**Business Interpretation**:

- **Weighted coefficients**: Estimated while giving more influence to high-value or reliable customers
- **weighted_mse**: Model error accounting for customer weights
- **Segment differences**: Premium customers may show different behavior than budget customers

**Why use WLS here**:

- **High-value customers**: Weight by LTV - premium customers get more influence in the model
- **Data reliability**: Weight by transaction count - customers with more data points get higher weight
- **Heteroscedasticity**: Variance may differ across customer types (premium vs budget)

**Business Decision**:

- **Premium segment**: If income sensitivity is high, target promotions at income milestones
- **Budget segment**: If income sensitivity is low, focus on value messaging rather than income targeting
- **Resource allocation**: Prioritize strategies for segments with strong, reliable patterns (high R², low weighted_mse)

**Example Insights**:

```
Premium segment: income_coef = 0.15, weighted_mse = 250 → Strong income effect, reliable estimate
Budget segment: income_coef = 0.08, weighted_mse = 180 → Weaker income effect, tighter variance
```

[↑ Go to Top](#business-guide)

## Financial Analytics

### Use Case 4: Portfolio Beta Calculation

**Business Question**: Measure market sensitivity of each stock for risk management.

<!-- include: test/sql/guide04_use_case_4_portfolio_beta_calculation.sql -->

**Business Interpretation**:

- **Beta = 1.0**: Moves with market (average risk)
- **Beta > 1.0**: More volatile than market (higher risk, higher potential return)
- **Beta < 1.0**: Less volatile than market (lower risk, lower potential return)
- **R² > 0.7**: Strong correlation with market

**Example Output**:

```
┌──────────────┬──────┬───────────┬───────────────┬───────────────────────┐
│ stock_ticker │ beta │ r_squared │ risk_category │ investor_suitability  │
├──────────────┼──────┼───────────┼───────────────┼───────────────────────┤
│ TECH         │ 1.45 │ 0.823     │ High Risk     │ Aggressive            │
│ GROWTH       │ 1.18 │ 0.756     │ High Risk     │ Aggressive            │
│ INDEX        │ 0.98 │ 0.912     │ Medium Risk   │ Moderate              │
│ UTILITY      │ 0.42 │ 0.645     │ Low Risk      │ Defensive             │
└──────────────┴──────┴───────────┴───────────────┴───────────────────────┘
```

**Business Decision**: Balance portfolio with mix of high/low beta stocks based on risk tolerance.

### Use Case 4b: Multi-Factor Portfolio Analysis with Ridge Aggregate

**Business Question**: How do multiple risk factors (market, sector, value) affect each stock? Handle correlated factors without multicollinearity issues.

**Method**: Use `anofox_statistics_ridge_agg` with GROUP BY to fit factor models per stock with L2 regularization to handle correlated risk factors.

<!-- include: test/sql/guide04_portfolio_beta_ridge.sql -->

**Business Interpretation**:

- **Market beta**: Stock's sensitivity to overall market movements
- **Sector beta**: Stock's sensitivity to sector-specific movements
- **Value factor**: Stock's tilt toward value vs growth stocks
- **Lambda (regularization)**: Controls shrinkage - stabilizes estimates when factors are correlated

**Why use Ridge here**:

- **Multicollinearity**: Market and sector returns are often correlated
- **Stability**: Ridge produces more stable factor exposures than OLS
- **Better out-of-sample**: Regularization prevents overfitting to historical patterns
- **Risk management**: More reliable factor exposures for hedging strategies

**Business Decision**:

- **Factor exposure**: Understand true drivers of each stock's returns
- **Portfolio construction**: Build factor-neutral or factor-tilted portfolios
- **Hedging**: Use stable factor estimates for risk management
- **Comparison**: Stocks with similar factor profiles can be treated as substitutes

**Choosing lambda**:

- **lambda = 0.1**: Light regularization (factors mostly uncorrelated)
- **lambda = 1.0**: Moderate regularization (standard choice)
- **lambda = 10.0**: Heavy regularization (factors highly correlated)

**Example Insights**:

```
TECH: market_beta = 1.2, sector_beta = 0.8, value = -0.3 → Growth stock, sector-heavy
UTIL: market_beta = 0.5, sector_beta = 0.3, value = 0.2 → Defensive stock, value tilt
```

### Use Case 5: Credit Risk Modeling

**Business Question**: Predict loan default risk to inform lending decisions.

<!-- include: test/sql/guide04_use_case_5_credit_risk_modeling.sql -->

**Business Interpretation**:

- **Positive coefficient**: Factor increases default probability
- **Negative coefficient**: Factor decreases default probability
- **P-value < 0.05**: Factor is statistically significant predictor

**Business Decision**: Adjust lending criteria based on most significant risk factors.

### Use Case 6: Revenue Forecasting with Trend Analysis

**Business Question**: Forecast next quarter's revenue with confidence intervals.

<!-- include: test/sql/guide04_use_case_6_revenue_forecasting_with_tren.sql -->

**Example Output**:

```
┌────────────────┬────────────┬──────────────────────────┬──────────────────────────────┬─────────────────────────────┬─────────────────┐
│ quarter_offset │ quarter_id │ forecast_revenue_millions│ conservative_estimate_millions│ optimistic_estimate_millions│ uncertainty_pct │
├────────────────┼────────────┼──────────────────────────┼──────────────────────────────┼─────────────────────────────┼─────────────────┤
│ 1              │ 21         │ 52.3                     │ 48.1                         │ 56.5                        │ 16.1            │
│ 2              │ 22         │ 54.8                     │ 49.8                         │ 59.8                        │ 18.2            │
│ 3              │ 23         │ 57.3                     │ 51.2                         │ 63.4                        │ 21.3            │
│ 4              │ 24         │ 59.8                     │ 52.4                         │ 67.2                        │ 24.7            │
└────────────────┴────────────┴──────────────────────────┴──────────────────────────────┴─────────────────────────────┴─────────────────┘
```

**Business Decision**: Plan for $52.3M revenue in Q21, with contingency plans for $48-56M range.

[↑ Go to Top](#business-guide)

## Operational Analytics

### Use Case 7: Demand Forecasting for Inventory

**Business Question**: Set inventory levels based on product demand predictions.

<!-- include: test/sql/guide04_use_case_7_demand_forecasting_for_invent.sql -->

**Business Decision**: Automate replenishment for high-confidence products, manual review for others.

### Use Case 7b: Adaptive Demand Forecasting with RLS Aggregate

**Business Question**: How can we create forecasts that automatically adapt to changing demand patterns per product? Which products have the most volatile demand?

**Method**: Use `anofox_statistics_rls_agg` with GROUP BY to fit adaptive models per product that emphasize recent patterns over historical data.

<!-- include: test/sql/guide04_adaptive_forecasting_rls.sql -->

**Business Interpretation**:

- **Adaptive coefficients**: Final model emphasizes recent demand patterns, automatically adjusting to changes
- **forgetting_factor**: Controls adaptation speed - lower values = faster response to changes
- **Per-product models**: Each product gets its own adaptive forecast model
- **Recent emphasis**: Old data is exponentially down-weighted

**Why use RLS here**:

- **Non-stationary demand**: Product demand patterns change over time (seasonality, trends, market shifts)
- **Fast adaptation**: Detects and responds to demand regime changes quickly
- **Automatic updates**: No need to retrain models - they adapt as new data arrives
- **Relevant patterns**: Recent data often predicts better than old data for operational decisions

**Business Decision**:

- **Inventory planning**: Use adaptive forecasts for ordering decisions
- **Volatility assessment**: Products with high forgetting_factor needs indicate unstable demand
- **Promotional impact**: RLS automatically adjusts to post-promotion demand changes
- **New product launches**: Adapts quickly as demand patterns stabilize

**Choosing forgetting_factor**:

- **λ = 0.98-0.99**: Slow adaptation - stable products with gradual changes
- **λ = 0.95-0.97**: Moderate adaptation - standard operational forecasting
- **λ = 0.90-0.94**: Fast adaptation - volatile products or rapid market changes
- **λ < 0.90**: Very fast - new products or post-disruption recovery

**Example Insights**:

```
Product A: coef = 1.2, λ = 0.95 → Growing demand, moderate volatility
Product B: coef = 0.8, λ = 0.90 → Declining demand, high volatility - needs attention
Product C: coef = 1.0, λ = 0.98 → Stable demand, predictable pattern
```

**Operational Actions**:

- **High adaptation needs (λ < 0.93)**: Review demand drivers, increase safety stock
- **Stable patterns (λ > 0.97)**: Can use tighter inventory controls
- **Growing trends (coef > 1.0)**: Plan capacity increases
- **Declining trends (coef < 1.0)**: Review product positioning, consider promotions

### Use Case 8: Quality Control Process Optimization

**Business Question**: Identify which process parameters affect product defects.

<!-- include: test/sql/guide04_use_case_8_quality_control_process_optim.sql -->

**Business Decision**: Adjust process parameters that significantly affect defect rates.

### Use Case 9: Employee Productivity Analysis

**Business Question**: Understand factors driving team productivity.

<!-- include: test/sql/guide04_use_case_9_employee_productivity_analysi.sql -->

**Business Decision**: Allocate training budget to departments with highest ROI.

[↑ Go to Top](#business-guide)

## Sales Analytics

### Use Case 10: Territory Performance Analysis

**Business Question**: Which territories are underperforming and why?

<!-- include: test/sql/guide04_use_case_10_territory_performance_analys.sql -->

**Business Decision**: Prioritize intervention in declining territories, invest in rising stars.

### Use Case 11: Regional Sales Analysis with OLS Aggregate

**Business Question**: How does pricing elasticity differ across regions? Which regions are most price-sensitive?

**Method**: Use `anofox_statistics_ols_agg` with GROUP BY to fit separate price-demand models per region in a single query.

<!-- include: test/sql/guide04_sales_by_region_aggregate.sql -->

**Business Interpretation**:

- **Price elasticity coefficient**: How quantity responds to price changes in each region
- **Negative values**: Normal demand curve - higher price → lower demand
- **R²**: How well price predicts demand in each region
- **Regional differences**: Some regions may be more price-sensitive than others

**Business Decision**:

- **High |elasticity| regions**: Use competitive pricing strategies, run promotions carefully
- **Low |elasticity| regions**: Can support premium pricing, focus on value messaging
- **Poor fit (low R²)**: Price isn't the main driver - investigate other factors (competition, demographics)

**Example Insights**:

```
North region: elasticity = -1.2, R² = 0.85 → Price-sensitive, good fit
South region: elasticity = -0.4, R² = 0.72 → Less price-sensitive, moderate fit
```

[↑ Go to Top](#business-guide)

## Key Business Metrics & Interpretation

### Understanding R² (R-Squared)

**What it means**: Percentage of variation in outcome explained by your model.

- **R² = 0.95**: Model explains 95% of variation (excellent for forecasting)
- **R² = 0.70**: Model explains 70% of variation (good for business decisions)
- **R² = 0.40**: Model explains 40% of variation (use with caution)

**Business Context**:

- **Marketing**: R² > 0.6 is strong (many external factors)
- **Finance**: R² > 0.7 expected (more predictable)
- **Operations**: R² > 0.8 desired (controlled environment)

### Understanding P-Values

**What it means**: Probability that relationship is due to chance.

- **p < 0.001**: Extremely strong evidence (***) - Very confident
- **p < 0.01**: Strong evidence (**) - Confident
- **p < 0.05**: Moderate evidence (*) - Reasonably confident
- **p > 0.05**: Weak evidence - Not confident

**Business Rule**: Only act on factors with p < 0.05 (95% confidence).

### Understanding Coefficients

**What it means**: How much Y changes when X increases by 1 unit.

**Example**: Marketing spend coefficient = 3.2

- For every $1 increase in marketing, revenue increases by $3.20
- ROI = 3.2 - 1 = 2.2, or 220% return

**Business Decision Framework**:

- If coefficient × volume > costs, invest
- If p-value < 0.05, trust the estimate
- If R² > 0.7, forecast with confidence

### Understanding Confidence Intervals

**What it means**: Range where true value likely falls (e.g., 90% or 95% confidence).

**Example**: Revenue forecast = $50M with 90% CI [$45M, $55M]

- Best estimate: $50M
- Conservative plan: $45M
- Optimistic plan: $55M
- Planning buffer: $5M variance

**Business Application**:

- **Budgeting**: Use lower bound (conservative)
- **Target Setting**: Use point estimate (realistic)
- **Capacity Planning**: Use upper bound (optimistic)

### Understanding Outliers & Influence

**Outliers**: Data points that don't fit the pattern.
**Influential**: Points that strongly affect the model.

**Business Decisions**:

- **Outlier + Influential**: Investigate (data error or special case?)
- **Outlier + Not Influential**: Monitor (unusual but not problematic)
- **Not Outlier + Influential**: Normal leverage point

**Example**:

- Q4 sales spike (outlier) due to holiday season → Keep (real pattern)
- Data entry error showing $10M sale → Remove (data quality issue)

[↑ Go to Top](#business-guide)

## ROI Analysis Framework

### Marketing Campaign ROI

<!-- include: test/sql/guide04_marketing_campaign_roi.sql -->

### Process Improvement ROI

**Formula**: (Defect Reduction × Cost per Defect) - Implementation Cost

Use regression to quantify defect reduction from process changes.

[↑ Go to Top](#business-guide)

## Best Practices for Business Users

### 1. Always Check Statistical Significance

Don't act on p-values > 0.05 unless you have strong business reasons.

### 2. Validate Model Quality

- Check R² before making forecasts
- Review residual diagnostics for unusual patterns
- Look for influential outliers

### 3. Use Confidence Intervals for Risk Management

- Plan for lower bound (pessimistic)
- Expect point estimate (realistic)
- Hope for upper bound (optimistic)

### 4. Consider Business Context

Statistical significance ≠ Business significance

**Example**:

- Coefficient = 0.001, p < 0.001 (statistically significant)
- But $1 increase → $0.001 revenue (not business significant)

### 5. Monitor Model Performance Over Time

Use rolling regressions to detect changes in relationships:

<!-- include: test/sql/guide04_5_monitor_model_performance_over_time.sql -->

### 6. Combine Multiple Models

Don't rely on single model - triangulate with multiple approaches:

<!-- include: test/sql/guide04_6_combine_multiple_models.sql -->

[↑ Go to Top](#business-guide)
